<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <title>Live Dashboard (WebSocket)</title>
  <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
  <style>
    body { font-family: sans-serif; padding: 20px; }
    table { border-collapse: collapse; width: 100%; }
    th, td { border: 1px solid #999; padding: 8px; text-align: center; }
    th { background: #eee; }
    .‡∏£‡∏≠‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡∏±‡∏ö { background: #ffffcc; }
    .‡∏≠‡∏¢‡∏π‡πà‡∏ö‡∏ô‡πÄ‡∏ß‡∏ó‡∏µ { background: #cce5ff; }
    .‡∏£‡∏±‡∏ö‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢ { background: #d4edda; }
    .‡∏Ç‡∏≤‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡∏±‡∏ö { background: #f8d7da; }
  </style>
</head>
<body>
  <h2>üì° Dashboard ‡πÄ‡∏£‡∏µ‡∏¢‡∏•‡πÑ‡∏ó‡∏°‡πå</h2>
  <table id="table">
    <thead>
      <tr>
        <th>‡∏•‡∏≥‡∏î‡∏±‡∏ö</th>
        <th>‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤</th>
        <th>‡∏ä‡∏∑‡πà‡∏≠</th>
        <th>‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏Å</th>
        <th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
        <th>‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</th>
        <th>RFID</th>
        <th>‡∏™‡πÅ‡∏Å‡∏ô‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà 1</th>
        <th>‡∏™‡πÅ‡∏Å‡∏ô‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà 2</th>
      </tr>
    </thead>
    <tbody>
      {% for row in rows %}
      <tr id="row-{{row[0]}}" class="{{ row[4] }}">
        <td>{{ row[0] }}</td>
        <td>{{ row[1] }}</td>
        <td>{{ row[2] }}</td>
        <td>{{ row[3] or '-' }}</td>
        <td>{{ row[4] }}</td>
        <td>{{ row[5] or '-' }}</td>
        <td>{{ row[6] or '-' }}</td>
        <td>{{ row[7] or '-' }}</td>
        <td>{{ row[8] or '-' }}</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>

  <script>
    const socket = io();

    socket.on("status_update", (data) => {
      const row = document.getElementById("row-" + data.order_no);
      if (row) {
        row.className = data.status;
        row.children[4].textContent = data.status;
        row.children[5].textContent = data.last_update || '-';
        row.children[3].textContent = data.call_time || '-';
        row.children[6].textContent = data.rfid || '-';
        row.children[7].textContent = data.scan_time_1 || '-';
        row.children[8].textContent = data.scan_time_2 || '-';
      }
    });
  </script>
</body>
</html>
